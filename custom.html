<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wplace ë§ì¶¤ ì§€ì  ê°ì‹œê¸°</title>
  <link rel="apple-touch-icon" sizes="180x180" href="custom favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="custom favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="custom favicon/favicon-16x16.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link rel="manifest" href="custom favicon/site.webmanifest">
  <style>

.info-modal {
  display: none;
  position: fixed;
  z-index: 1500;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0);
  transition: background-color 0.3s ease;
}

.info-modal.show {
  background-color: rgba(0,0,0,0.5);
}

.info-modal.show .modal-content {
  transform: scale(1) translateY(0);
  opacity: 1;
}

.info-modal h3 {
  margin-top: 0;
  color: var(--accent);
  text-align: center;
}


.info-btn {
  position: absolute;
  top: 20px;
  left: 20px;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 50%;
  width: 45px;
  height: 45px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  z-index: 100;
}

/* ì„œë²„ ìƒíƒœ í‘œì‹œë“± ìŠ¤íƒ€ì¼ (ì¶”ê°€í•  ì½”ë“œ) */
.server-status {
  position: absolute;
  top: 25px;
  left: 80px;
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 20px;
  padding: 8px 15px;
  font-size: 14px;
  font-weight: 500;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  cursor: default;
  z-index: 100;
}

.status-light {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background-color: #888; /* ê¸°ë³¸ íšŒìƒ‰ */
  transition: background-color 0.5s ease, box-shadow 0.5s ease;
}

/* ìƒíƒœë³„ ìƒ‰ìƒ ì •ì˜ */
.server-status.ok .status-light {
  background-color: #28a745; /* ì´ˆë¡ */
  box-shadow: 0 0 8px rgba(40, 167, 69, 0.7);
}

.server-status.error .status-light {
  background-color: #ff4444; /* ë¹¨ê°• */
  box-shadow: 0 0 8px rgba(255, 68, 68, 0.7);
}

.server-status.unknown .status-light {
  background-color: #ffbb33; /* ì£¼í™© */
  box-shadow: 0 0 8px rgba(255, 187, 51, 0.7);
}


/* ìƒíƒœ í‘œì‹œë“± ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ ë¶€ëª¨ ìš”ì†Œ */
.status-light-wrapper {
  position: relative;
  width: 12px;
  height: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* í¼ì ¸ë‚˜ê°€ëŠ” ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
@keyframes pulse-animation {
  0% {
    transform: scale(1);
    opacity: 0.6;
  }
  100% {
    transform: scale(3);
    opacity: 0;
  }
}

.status-light-wrapper .pulse {
  position: absolute;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background-color: currentColor; /* ë¶€ëª¨ì˜ ìƒ‰ìƒì„ ìƒì†ë°›ìŒ */
  animation: pulse-animation 1s ease-out;
  animation-fill-mode: forwards; /* ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ ìƒíƒœ ìœ ì§€ */
}

/* ì»¤ìŠ¤í…€ íˆ´íŒ(ë§í’ì„ ) ìŠ¤íƒ€ì¼ */
.custom-tooltip {
  position: absolute;
  bottom: -120%; /* ìƒíƒœ í‘œì‹œë“± ìœ„ìª½ì— ìœ„ì¹˜ */
  left: 50%;
  transform: translateX(-50%);
  background-color: #333;
  color: #fff;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 13px;
  white-space: nowrap;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease, visibility 0.2s ease;
  z-index: 110;
}

/* ë§í’ì„  ê¼¬ë¦¬ */
.custom-tooltip::after {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #333 transparent;
}

/* í˜¸ë²„ ì‹œ íˆ´íŒ ë³´ì´ê¸° */
.server-status:hover .custom-tooltip {
  opacity: 1;
  visibility: visible;
}

  .info-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.info-btn i {
  color: var(--text-color);
  font-size: 20px;
}

.info-body {
  max-height: 60vh;
  overflow-y: auto;
  font-size: 15px;
  line-height: 1.6;
  color: var(--text-color);
}

    :root {
      --frame-bg: #e6e5e5;
      --gap: 18px;
      --accent: #0055ff;
      /* ë¼ì´íŠ¸ ëª¨ë“œ ìƒ‰ìƒ */
      --bg-color: #f8f9fa;
      --text-color: #111;
      --card-bg: #fff;
      --border-color: #ccc;
      --input-bg: #fff;
    }

    [data-theme="dark"] {
      --bg-color: #1a1a1a;
      --text-color: #e0e0e0;
      --card-bg: #2d2d2d;
      --border-color: #444;
      --input-bg: #333;
      --frame-bg: #636363;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .wrap {
      max-width: 1200px;
      margin: 28px auto;
      padding: 20px
    }

    header {
      text-align: center;
      margin-bottom: 24px
    }

    header h1 {
      font-size: 26px;
      margin: 0;
      color: var(--accent)
    }

    header p {
      font-size: 15px;
      color: var(--text-color);
      margin: 6px 0 0
    }

    .dark-mode-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      z-index: 100;
    }

    .dark-mode-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .dark-mode-toggle svg {
      width: 24px;
      height: 24px;
      color: var(--text-color);
      transition: transform 0.3s ease;
    }

    .dark-mode-toggle.rotating svg {
      transform: rotate(180deg);
    }

    .paint-calculator-btn {
  position: absolute;
  top: 80px;
  right: 20px;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  z-index: 100;
}

.paint-calculator-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.paint-calculator-btn i {
  color: var(--text-color);
  font-size: 20px;
}

.calculator-modal {
  display: none;
  position: fixed;
  z-index: 1500;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0);
  transition: background-color 0.3s ease;
}

.calculator-modal.show {
  background-color: rgba(0,0,0,0.5);
}

.calculator-modal.show .calculator-content {
  transform: scale(1) translateY(0);
  opacity: 1;
}

.calculator-content {
  background-color: var(--card-bg);
  margin: 5% auto;
  padding: 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 450px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  transform: scale(0.7) translateY(-100px);
  opacity: 0;
  transition: all 0.3s ease;
}

.calculator-content h3 {
  margin-top: 0;
  color: var(--accent);
  text-align: center;
  margin-bottom: 20px;
}

.calc-form-group {
  margin: 20px 0;
}

.calc-form-group label {
  display: block;
  font-weight: 500;
  color: var(--text-color);
  font-size: 16px;
}

.calc-form-group input[type="number"] {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  font-size: 15px;
  box-sizing: border-box;
  background: var(--input-bg);
  color: var(--text-color);
}

.calc-form-group input[type="checkbox"] {
  align-items: center;
  width: 18px;
  height: 18px;
  margin-right: 8px;
  cursor: pointer;
}

.checkbox-label {
  display: flex;
  align-items: center;
  cursor: pointer;
}

label.checkbox-label {
  display: flex;
  align-items: center; 
  margin-bottom: 2px;
}

input#hasFlagBadge {
  margin-top: 0; /* Remove top margin */
  margin-bottom: 0; /* Remove bottom margin */
  /* Or simply: margin: 0; */
}

.result-box {
  background: var(--frame-bg);
  border-radius: 8px;
  padding: 15px;
  margin: 20px 0;
  min-height: 60px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.result-box .result-label {
  font-size: 13px;
  color: var(--text-color);
  opacity: 0.8;
  margin-bottom: 5px;
}

.result-box .result-value {
  font-size: 22px;
  font-weight: bold;
  color: var(--accent);
}

/* ë‹¤í¬ëª¨ë“œì—ì„œ ë” ë°ì€ ìƒ‰ìƒ ì ìš© */
[data-theme="dark"] .result-box .result-value {
  color: #3d8bff; /* ë” ë°ì€ íŒŒë€ìƒ‰ */
  text-shadow: 0 0 1px rgba(61, 139, 255, 0.3); /* ì•½ê°„ì˜ ê·¸ë¦¼ì íš¨ê³¼ */
}

[data-theme="dark"] .result-box .result-label {
  color: #e0e0e0; /* ë¼ë²¨ë„ ë°ê²Œ */
  opacity: 0.9;
}

.calc-buttons {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 20px;
}

    .controls {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      margin-bottom: 20px;
    }

    .controls label {
      font-size: 14px;
      margin-right: 8px
    }

    .controls input {
      width: 70px;
      padding: 4px;
      font-size: 14px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 6px
    }

    .controls button {
      margin-right: 3px; /* ê° ë²„íŠ¼ ì‚¬ì´ ì—¬ë°± */
    }


    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--gap)
    }

    @media (min-width: 768px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease;
    }

    .form-group input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
      background: var(--input-bg);
      color: var(--text-color);
      transition: border-color 0.3s ease, background-color 0.3s ease;
    }

    .controls input {
      width: 70px;
      padding: 4px;
      font-size: 14px;
      text-align: center;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background: var(--input-bg);
      color: var(--text-color);
      transition: border-color 0.3s ease, background-color 0.3s ease;
    }

    .modal-content {
      background-color: var(--card-bg);
      margin: 2% auto;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transform: scale(0.7) translateY(-100px);
      opacity: 0;
      transition: all 0.3s ease;
    }

    .confirm-content {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      margin: 20px;
      transform: scale(0.8) translateY(-50px);
      opacity: 0;
      transition: all 0.3s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.12)
    }

    .add-card {
      background: var(--card-bg);
      border: 2px dashed var(--border-color);
      cursor: pointer;
      justify-content: center;
      align-items: center;
      min-height: 200px;
    }

    .add-card:hover {
      border-color: var(--accent);
      background: var(--card-bg);
      opacity: 0.8;
    }

    .add-icon {
      width: 48px;
      height: 48px;
      color: var(--text-color);
      margin-bottom: 10px;
    }

    .add-text {
      color: var(--text-color);
      font-size: 16px;
    }

    .card-header {
      position: relative;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 10px;
      min-height: 40px;
    }

    .card .meta {
      display: flex;
      justify-content: center;
      align-items: center;
      flex: 1;
    }

    .card .meta strong {
      font-size: 16px;
      color: var(--text-color)
    }

    .card-buttons {
      position: absolute;
      top: 0;
      right: 0;
      display: flex;
      gap: 4px;
      z-index: 10;
    }

    .delete-btn, .edit-btn {
      background: #ff4444;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 4px 8px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .edit-btn {
      background: #28a745;
    }

    .delete-btn:hover {
      background: #cc0000;
      transform: translateY(-1px);
    }

    .edit-btn:hover {
      background: #1e7e34;
      transform: translateY(-1px);
    }

    .goto-btn {
      background: linear-gradient(135deg, #0055ff, #0099ff);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 4px 8px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 2px;
      text-decoration: none;
      box-shadow: 0 2px 6px rgba(0, 85, 255, 0.3);
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .goto-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 85, 255, 0.4);
    }

    .goto-btn svg {
      width: 10px;
      height: 10px;
    }

    /* ë‹¤í¬ëª¨ë“œ í† ê¸€ ì˜†ì˜ ë¹ ë¥¸ ë§í¬ ë²„íŠ¼ */
    .quick-link-btn {
      position: absolute;
      top: 28px;
      right: 90px; /* ë‹¤í¬ëª¨ë“œ ë²„íŠ¼ë³´ë‹¤ ì™¼ìª½ìœ¼ë¡œ ë°°ì¹˜ */
      background: linear-gradient(135deg, #0055ff, #0099ff);
      color: white;
      border: none;
      border-radius: 15px;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      text-decoration: none;
      box-shadow: 0 2px 6px rgba(0, 85, 255, 0.3);
      transition: all 0.2s ease;
      z-index: 99;
    }
  
    .btn-export, .btn-import {
      border: none;
      border-radius: 12px;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 500;
      color: white;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      transition: all 0.2s ease;
      margin: 0 6px;
    }

    /* ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ (ì´ˆë¡ìƒ‰ ê³„ì—´) */
  .btn-export {
  background: linear-gradient(135deg, #28a745, #20c997);
    }

    /* ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ (íŒŒë€ìƒ‰ ê³„ì—´, í˜¹ì€ ëŒ€ì•ˆ ìƒ‰ìƒë“¤) */
    .btn-import {
      background: linear-gradient(135deg, #0055ff, #0099ff);
    }

    /* ëŒ€ì•ˆ ìƒ‰ìƒ ê²½ìš°ì˜ ìˆ˜
       - ë³´ë¼ìƒ‰ ê³„ì—´: linear-gradient(135deg, #6f42c1, #b37feb);
       - ì£¼í™©ìƒ‰ ê³„ì—´: linear-gradient(135deg, #fd7e14, #ffa94d);
       - ì²­ë¡ìƒ‰ ê³„ì—´: linear-gradient(135deg, #20c997, #12b886);
    */

    .btn-export:hover, .btn-import:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.25);
    }

    .btn-export i, .btn-import i {
      font-size: 14px;
    }

     .quick-link-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 85, 255, 0.4);
    }

    .quick-link-btn svg {
      width: 15px;
      height: 15px;
    }


    .confirm-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      transition: background-color 0.3s ease;
    }

    .confirm-dialog.show {
      background: rgba(0, 0, 0, 0.5);
    }

    .confirm-dialog.show .confirm-content {
      transform: scale(1) translateY(0);
      opacity: 1;
    }

    .confirm-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }

    .download-btn {
      position: absolute;
      top: 8px;
      left: 8px;
      z-index: 20;
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      border: none;
      border-radius: 6px;
      width: 32px;
      height: 32px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(40, 167, 69, 0.3);
      transition: all 0.2s ease;
    }

    .download-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(40, 167, 69, 0.4);
    }

    .download-btn svg {
      width: 16px;
      height: 16px;
    }

    .frame {
      width: 100%;
      height: 420px;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      background: var(--frame-bg)
    }

    .frame img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: opacity 0.3s ease;
    }

    .frame img.hidden {
      opacity: 0
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0);
      transition: background-color 0.3s ease;
    }

    .modal.show {
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal.show .modal-content {
      transform: scale(1) translateY(0);
      opacity: 1;
    }

    .modal h3 {
      margin-top: 0;
      color: var(--accent);
      text-align: center;
    }

    .form-group {
      margin: 15px 0;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--text-color);
    }

    .form-row {
      display: flex;
      gap: 10px;
    }

    .form-row input {
      flex: 1;
    }

    .form-group input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: #0044cc;
    }

    .btn-secondary {
      background: #ccc;
      color: #333;
    }

    .btn-secondary:hover {
      background: #bbb;
    }

    .preview-image {
      max-width: 100%;
      height: 200px;
      object-fit: contain;
      border: 1px solid #ddd;
      border-radius: 6px;
      margin: 10px 0;
    }

    footer {
      margin-top: 40px;
      text-align: center;
      font-size: 14px;
      color: var(--text-color);
      padding-bottom: 60px;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: bold;
    }

    .error {
      color: #ff4444;
      font-size: 14px;
    }
  </style>
</head>

<body>
<!-- ì •ë³´ ë²„íŠ¼ -->
<button id="infoBtn" class="info-btn" title="ì‚¬ì´íŠ¸ ì´ìš© ì•ˆë‚´">
  <i class="fa-solid fa-circle-info"></i>
</button>

<div id="serverStatus" class="server-status">
  <div class="status-light-wrapper">
    <div class="status-light"></div>
  </div>
  <span class="status-text">í™•ì¸ ì¤‘...</span>
  <div id="customTooltip" class="custom-tooltip">ì„œë²„ ìƒíƒœ í™•ì¸ ì¤‘...</div>
</div>

<!-- ì •ë³´ ëª¨ë‹¬ -->
<div id="infoModal" class="info-modal">
  <div class="modal-content">
    <h3>ì‚¬ì´íŠ¸ ì´ìš© ì•ˆë‚´</h3>
    <div class="info-body">
      <h2 id="second-heading">ì´ìš© ë°©ë²•</h2>
      1. ê°ì‹œí•˜ê³  ì‹¶ì€ íƒ€ì¼ ì¢Œí‘œ(Tl X, Tl Y)ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤. <br>â € íƒ€ì¼ ì¢Œí‘œë¥¼ ì•Œì•„ë‚´ê¸° ìœ„í•´ <a href="https://gall.dcinside.com/mgallery/board/view/?id=wplacelive&no=1204&search_head=30&page=1" target="_blank">ë¸”ë£¨ ë§ˆë¸”</a> ê³„ì—´ì˜ í”ŒëŸ¬ê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>
      2. ë¯¸ë¦¬ë³´ê¸°ë¥¼ ëˆŒëŸ¬ ì´ë¯¸ì§€ê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.<br>
      3. í”½ì…€ ì¢Œí‘œ(Px X, Px Y)ì™€ í™•ëŒ€ ë¹„ìœ¨ ë“±ì„ ì…ë ¥í•œ ë’¤ ì¶”ê°€í•©ë‹ˆë‹¤.<br>â € í•„ìš”ì— ë”°ë¼ ì¢Œí‘œë¥¼ ë¯¸ì„¸ì¡°ì •í•´ ì‘í’ˆì„ ì •ë ¬í•˜ì„¸ìš”.<br>
      4. ìƒˆë¡œê³ ì¹¨ ê°„ê²©ì„ ì¡°ì •í•´ ìë™ ê°±ì‹  ì£¼ê¸°ë¥¼ ì„¤ì •í•˜ì„¸ìš”.<br>
      5. ì›í•˜ëŠ” ë§Œí¼ ì§€ì ì„ ì¶”ê°€í•´ ê°ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
      6. ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ í˜„ì¬ ì„¤ì •ì„ JSON íŒŒì¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
      7. ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ì´ì „ì— ì €ì¥í•œ JSON íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
      8. ë‹¤í¬ëª¨ë“œëŠ” ì˜¤ë¥¸ìª½ ìƒë‹¨ í•´/ë‹¬ ì•„ì´ì½˜ìœ¼ë¡œ ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>

      <h2><strong>ë¬¸ì œ í•´ê²°</strong></h2>
      <strong>- ì´ë¯¸ì§€ê°€ ì•ˆëœ¨ëŠ”ë°?</strong><br>ë‹¤ìˆ˜ì˜ ì´ë¯¸ì§€ë¥¼ ì§§ì€ ì‹œê°„ì— ë¶ˆëŸ¬ì˜¤ë ¤ê³  í• ë•Œ, Rate Limitì— ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° ìƒˆë¡œê³ ì¹¨ ê°„ê²©ì„ ëŠ˜ë¦¬ê³  ì ì‹œ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”.<br>ë˜ëŠ”, <a href="https://wplace.instatus.com/" target="_blank">ì—¬ê¸°ì—ì„œ</a> ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.<br>
      <strong>- íƒ€ì¼ ì´ë¯¸ì§€ê°€ ì”¹ì°½ë‚˜ê³  ê¼¬ì¸ê²ƒ ê°™ì€ë°?</strong><br> ë²„ê·¸ì¼ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. ê¸°íƒ€ë€ì˜ ë²„ê·¸ ì‹ ê³  ë°©ë²•ì„ ì°¸ê³ í•´ ì‹ ê³ í•´ ì£¼ì„¸ìš”.<br>

      <h2><strong>ê¸°íƒ€</strong></h2>
      <strong>- ë²„ê·¸ ì°¾ì•˜ë‹¤!</strong><br>
      ì¶•í•˜ë“œë¦½ë‹ˆë‹¤. ë²„ê·¸ë¥¼ ì°¾ìœ¼ì…¨êµ°ìš”. í˜ì´ì§€ í•˜ë‹¨ì˜ ë””ìŠ¤ì½”ë“œ ë§í¬ ë° ìœ ì €ëª…ì„ ì°¸ê³ í•˜ì—¬ ì‹ ê³ í•´ì£¼ì„¸ìš”. ë˜ëŠ”, <a href="https://github.com/wplaceBackend/wplaceBackend.github.io" target="_blank">ê¹ƒí—™</a>ì— ì‹ ê³ í•´ì£¼ì…”ë„ ë©ë‹ˆë‹¤. <br>
      <strong>- ë‚˜ ì½”ë”© ì¢€ í•´ë´¤ëŠ”ë°, ì´ê±° ë” ê°œì„ í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ìŒ</strong><br>
      ê°ì‚¬í•©ë‹ˆë‹¤. ê¹ƒí—™ ì €ì¥ì†Œë¥¼ ì´ìš©í•˜ì‹œê±°ë‚˜ ë””ìŠ¤ì½”ë“œë¡œ ì™€ì£¼ì„¸ìš”. ì ê·¹ ê²€í†  í•˜ê² ìŠµë‹ˆë‹¤.<br>
      <strong>- ì´ê±° ì™œ html, css, js ë‹¤ í•œê³³ì— ëª¨ì•„ë†“ìŒ?</strong><br>
      AIí•œí…Œ ë¬¼ì–´ë³´ê¸° í¸í•˜ê³ , ë°°í¬í•˜ê¸°ë„ í¸í•©ë‹ˆë‹¤. íŠ¹íˆ ë‹¤ ë‚˜ëˆ ì ¸ ìˆìœ¼ë©´ AI íŒŒì¼ ì—…ë¡œë“œ íšŸìˆ˜ê°€ ë§ì•„ì ¸ì„œ ë¹„íš¨ìœ¨ì ì´ê±°ë“ ìš”.<br>
    </div>
    <div class="modal-buttons">
      <button id="infoClose" class="btn btn-primary">í™•ì¸</button>
    </div>
  </div>
</div>

  <div class="wrap">
    <!-- ë°”ë¡œê°€ê¸° ìŠ¤íƒ€ì¼ì˜ ìƒˆ ë²„íŠ¼ -->
<a href="https://wplacebackend.github.io/" target="_blank" class="quick-link-btn" title="ì£¼ìš” ê±°ì  ê°ì‹œê¸° ì—´ê¸°">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M64 32C64 14.3 49.7 0 32 0S0 14.3 0 32L0 480c0 17.7 14.3 32 32 32s32-14.3 32-32l0-121.6 62.7-18.8c41.9-12.6 87.1-8.7 126.2 10.9 42.7 21.4 92.5 24 137.2 7.2l37.1-13.9c12.5-4.7 20.8-16.6 20.8-30l0-247.7c0-23-24.2-38-44.8-27.7l-11.8 5.9c-44.9 22.5-97.8 22.5-142.8 0-36.4-18.2-78.3-21.8-117.2-10.1L64 54.4 64 32z"/></svg>
  ì£¼ìš” ê±°ì  ê°ì‹œí•˜ëŸ¬ ê°€ê¸°
</a>

     <button class="dark-mode-toggle" id="darkModeToggle" title="ë‹¤í¬ëª¨ë“œ ì „í™˜">
       <svg id="sunIcon" viewBox="0 0 24 24" fill="currentColor">
         <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.591a.75.75 0 101.06 1.06l1.591-1.591zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.591-1.591a.75.75 0 10-1.06 1.06l1.591 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.591a.75.75 0 001.06 1.06l1.591-1.591zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06L6.166 5.106a.75.75 0 00-1.06 1.06l1.591 1.591z"/>
    </svg>
    <svg id="moonIcon" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
      <path d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z"/>
    </svg>
    <button class="paint-calculator-btn" id="paintCalcBtn" title="í˜ì¸íŠ¸ ì†Œìš” ì‹œê°„ ê³„ì‚°ê¸°">
      <i class="fa-solid fa-calculator"></i>
  </button>
    
    <header>
      <h1>Wplace ë§ì¶¤ ì§€ì  ê°ì‹œê¸°</h1>
      <p>ê°ì‹œí•˜ê³  ì‹¶ì€ ì§€ì ì„ ì¶”ê°€í•˜ê³  ìƒˆë¡œê³ ì¹¨ ì‹œê°„ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </header>

<div class="controls">
  <label for="interval">ìƒˆë¡œê³ ì¹¨ ê°„ê²©(ì´ˆ):</label>
  <input type="number" id="interval" value="30" min="1" />
  
  <button id="exportBtn" class="btn-export">
    <i class="fa-solid fa-download"></i> ë‚´ë³´ë‚´ê¸°
  </button>
  <button id="importBtn" class="btn-import">
    <i class="fa-solid fa-cloud-arrow-up"></i> ë¶ˆëŸ¬ì˜¤ê¸°
  </button>
  <input type="file" id="importFile" accept=".json" style="display:none;">
</div>

    <main class="grid" id="mainGrid">
      <div class="card add-card" id="addCard">
        <svg class="add-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
        </svg>
        <div class="add-text">ê°ì‹œ ì§€ì  ì¶”ê°€</div>
      </div>
    </main>
  </div>

  <!-- ëª¨ë‹¬ -->
  <div id="addModal" class="modal">
    <div class="modal-content">
      <h3>ê°ì‹œ ì§€ì  ì¶”ê°€</h3>
      
      <div class="form-group">
        <label>ì‘í’ˆì´ ì†í•´ ìˆëŠ” íƒ€ì¼ ì¢Œí‘œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</label>
        <div class="form-row">
          <input type="number" id="tileX" placeholder="Tl X" required>
          <input type="number" id="tileY" placeholder="Tl Y" required>
        </div>
        <div class="error" id="tileError"></div>
      </div>

      <div class="form-group">
        <button type="button" class="btn btn-primary" id="loadPreview">ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</button>
      </div>

      <div id="previewSection" style="display: none;">
        <div class="form-group">
          <img id="previewImage" class="preview-image" alt="ë¯¸ë¦¬ë³´ê¸°">
        </div>

        <div class="form-group">
          <label>ì‘í’ˆì˜ í”½ì…€ ì¢Œí‘œ, í™•ëŒ€ ë¹„ìœ¨, ìµœì†Œ ë³´ì¥ í­(ì„ íƒ)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</label>
          <div class="form-row">
            <input type="number" id="pixelX" placeholder="Px X" required>
            <input type="number" id="pixelY" placeholder="Px Y" required>
          </div>
          <div class="form-row">
            <input type="number" id="baseScale" placeholder="í™•ëŒ€ ë¹„ìœ¨" step="0.1" required>
            <input type="number" id="minWidth" placeholder="ìµœì†Œ ë³´ì¥ í­ (ì„ íƒ)" step="1">
          </div>
          <div class="error" id="pixelError"></div>
        </div>

        <div class="form-group">
          <label for="cardName">ì§€ì  ì´ë¦„:</label>
          <input type="text" id="cardName" placeholder="ì§€ì  ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
          <div class="error" id="nameError"></div>
        </div>

        <div class="form-group">
          <label for="shareLink">ì¥ì†Œ ë°”ë¡œê°€ê¸° ë§í¬ (ì„ íƒ):</label>
          <input type="url" id="shareLink" placeholder="https://wplace.live/?lat=...">
          <div class="error" id="linkError"></div>
        </div>
      </div>

      <div class="modal-buttons">
        <button type="button" class="btn btn-secondary" id="cancelBtn">ì·¨ì†Œ</button>
        <button type="button" class="btn btn-primary" id="addBtn" style="display: none;">ì¶”ê°€</button>
      </div>
    </div>
  </div>

  <!-- í˜ì¸íŠ¸ ê³„ì‚°ê¸° ëª¨ë‹¬ -->
<div id="calculatorModal" class="calculator-modal">
  <div class="calculator-content">
    <h3>ğŸ¨ í˜ì¸íŠ¸ ì†Œìš” ì‹œê°„ ê³„ì‚°ê¸°</h3>
    
    <div class="calc-form-group">
      <label for="remainingPixels">ë‚¨ì€ í”½ì…€ ìˆ˜:</label>
      <input type="number" id="remainingPixels" placeholder="ì˜ˆ: 1000" min="1" value="">
    </div>

    <div class="calc-form-group">
      <label class="checkbox-label">
        <input type="checkbox" id="hasFlagBadge">
        <span>êµ­ê¸° ë³´ìœ  (10% í™˜ê¸‰)</span>
      </label>
    </div>

    <div class="result-box" id="resultBox">
      <div class="result-label">ì˜ˆìƒ ì†Œìš” ì‹œê°„</div>
      <div class="result-value" id="resultValue">ì…ë ¥ í›„ ê³„ì‚°ë©ë‹ˆë‹¤</div>
    </div>

    <div class="calc-buttons">
      <button type="button" class="btn btn-secondary" id="calcCloseBtn">ë‹«ê¸°</button>
      <button type="button" class="btn btn-primary" id="calculateBtn">ê³„ì‚°í•˜ê¸°</button>
    </div>
  </div>
</div>

  <footer>
    ë§Œë“  ë†ˆ - <a href="discord://-/users/1143199445035536404">OrangeBlue</a> <br> ë””ìŠ¤ì½”ë“œ @orangeblue2336
  </footer>

  <script>
    const serverStatusElement = document.getElementById('serverStatus');
    const statusLight = serverStatusElement.querySelector('.status-light');
    const statusText = serverStatusElement.querySelector('.status-text');
    const customTooltip = document.getElementById('customTooltip');
    const statusLightWrapper = serverStatusElement.querySelector('.status-light-wrapper');

    const paintCalcBtn = document.getElementById("paintCalcBtn");
    const calculatorModal = document.getElementById("calculatorModal");
    const calcCloseBtn = document.getElementById("calcCloseBtn");
    const calculateBtn = document.getElementById("calculateBtn");
    const remainingPixelsInput = document.getElementById("remainingPixels");
    const hasFlagBadgeCheckbox = document.getElementById("hasFlagBadge");
    const resultValue = document.getElementById("resultValue");

    const PROXY_URL_BASE = 'https://wplace-cors-proxy.snackcandy105.workers.dev/?url=';

    let intervalSec = 30;
    let timer;
    let cardCounter = 0;
    let monitorCards = [];
    let refreshTimer = null;

async function checkServerStatus() {
  playPulseAnimation(); // ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰ ì½”ë“œ ì¶”ê°€
  
  // AbortControllerë¥¼ ì‚¬ìš©í•´ 5ì´ˆ íƒ€ì„ì•„ì›ƒ ì„¤ì •
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), 5000); // 5ì´ˆ

  try {
    // wplace.liveì˜ favicon.icoëŠ” ìš©ëŸ‰ì´ ì‘ê³  ìºì‹œ ì •ì±…ì´ ì§§ì•„ í™•ì¸ìš©ìœ¼ë¡œ ì í•©í•©ë‹ˆë‹¤.
    // Date.now()ë¥¼ ì¿¼ë¦¬ë¡œ ì¶”ê°€í•˜ì—¬ ìºì‹œë¥¼ ë¬´ì‹œí•˜ê³  í•­ìƒ ìƒˆë¡œ ìš”ì²­í•©ë‹ˆë‹¤.
    const response = await fetch('https://wplace-cors-proxy.snackcandy105.workers.dev/?url=https://backend.wplace.live/files/s0/tiles/1774/795.png?t=' + Date.now( ), {
      method: 'HEAD', // HEAD ë©”ì†Œë“œë¡œ ìš”ì²­í•˜ë©´ ë³¸ë¬¸ ì—†ì´ í—¤ë”ë§Œ ë°›ì•„ì™€ ë¹ ë¦…ë‹ˆë‹¤.
      signal: controller.signal,
      cache: 'no-store' // ìºì‹œ ì‚¬ìš© ì•ˆí•¨
    });

    clearTimeout(timeoutId);

    if (response.ok) {
      // ìš”ì²­ ì„±ê³µ (200-299 ìƒíƒœ ì½”ë“œ)
      updateStatus('ok', 'ì„œë²„ ì›í™œ' , `ì •ìƒ ì‘ë‹µ (ì½”ë“œ: ${response.status})`);
    } else {
      // ì„œë²„ëŠ” ì‘ë‹µí–ˆìœ¼ë‚˜, ì •ìƒì ì¸ ìƒíƒœ ì½”ë“œê°€ ì•„ë‹˜
      updateStatus('error', 'ì ‘ì† ë¶ˆê°€', `ì„œë²„ ì˜¤ë¥˜ (ì½”ë“œ: ${response.status})`);
    }
  } catch (error) {
    clearTimeout(timeoutId);
    if (error.name === 'AbortError') {
      // ìš”ì²­ ì‹œê°„ ì´ˆê³¼
      updateStatus('error', 'ì ‘ì† ë¶ˆê°€', 'ì‘ë‹µ ì‹œê°„ ì´ˆê³¼');
    } else {
      // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë“± ê¸°íƒ€ ë¬¸ì œ
      updateStatus('unknown', 'í™•ì¸ ë¶ˆê°€', 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜');
    }
  }
}

function updateStatus(status, mainText, tooltipText) {
  const isChanging = !serverStatusElement.classList.contains(status);

  serverStatusElement.className = 'server-status ' + status;
  statusText.textContent = mainText;
  customTooltip.textContent = `ë°±ì—”ë“œ ì„œë²„ ìƒíƒœ: ${tooltipText}`; // ì»¤ìŠ¤í…€ íˆ´íŒ ë‚´ìš© ì—…ë°ì´íŠ¸

  // ìƒíƒœê°€ ë³€ê²½ë  ë•ŒëŠ” ì• ë‹ˆë©”ì´ì…˜ì„ ê±´ë„ˆë›°ê³ ,
  // ìƒíƒœê°€ ìœ ì§€ë  ë•Œë§Œ ì• ë‹ˆë©”ì´ì…˜ì„ ì¬ìƒí•©ë‹ˆë‹¤.
  if (!isChanging) {
    playPulseAnimation();
  }
}

function playPulseAnimation() {
  // ê¸°ì¡´ ì• ë‹ˆë©”ì´ì…˜ ìš”ì†Œ ì œê±°
  const existingPulses = statusLightWrapper.querySelectorAll('.pulse');
  existingPulses.forEach(p => p.remove());

  // í˜„ì¬ ìƒíƒœ í‘œì‹œë“±ì˜ ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸°
  const currentColor = window.getComputedStyle(statusLight).backgroundColor;

  // 2ë²ˆì˜ í„ìŠ¤ íš¨ê³¼ ìƒì„±
  for (let i = 0; i < 2; i++) {
    setTimeout(() => {
      const pulse = document.createElement('div');
      pulse.className = 'pulse';
      pulse.style.color = currentColor; // ì• ë‹ˆë©”ì´ì…˜ ìƒ‰ìƒ ì„¤ì •
      statusLightWrapper.appendChild(pulse);
      
      // ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚˜ë©´ DOMì—ì„œ ì œê±°
      pulse.addEventListener('animationend', () => {
        pulse.remove();
      });
    }, i * 300); // 0.3ì´ˆ ê°„ê²©ìœ¼ë¡œ ì‹¤í–‰
  }
}

// 1ë¶„ì— í•œ ë²ˆì”© ì„œë²„ ìƒíƒœ í™•ì¸
setInterval(checkServerStatus, 60000); 
// í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ í•œ ë²ˆ ì‹¤í–‰
checkServerStatus();


    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ
    function loadFromStorage() {
      try {
        const saved = JSON.parse(localStorage.getItem('wplace-monitor-cards') || '[]');
        const savedInterval = parseInt(localStorage.getItem('wplace-monitor-interval') || '30');
        
        intervalSec = savedInterval;
        document.getElementById('interval').value = intervalSec;
        
        saved.forEach(cardData => {
          createCard(cardData);
        });
        
        if (monitorCards.length > 0) {
          applyFocusAll();
        }
      } catch (e) {
        console.error('Failed to load from storage:', e);
      }
    }

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
    function saveToStorage() {
      try {
        const cardsData = monitorCards.map(card => ({
          id: card.id,
          name: card.name,
          tileX: card.tileX,
          tileY: card.tileY,
          cx: card.cx,
          cy: card.cy,
          baseScale: card.baseScale,
          minWidth: card.minWidth,
          shareLink: card.shareLink
        }));
        
        localStorage.setItem('wplace-monitor-cards', JSON.stringify(cardsData));
        localStorage.setItem('wplace-monitor-interval', intervalSec.toString());
      } catch (e) {
        console.error('Failed to save to storage:', e);
      }
    }

    function refreshImages(imgElements) {
      imgElements.forEach(img => {
        if (!img || !img.dataset.src) return;
        
        const base = img.dataset.src;
        const url = base + (base.includes('?') ? '&' : '?') + 't=' + Date.now();

        const preload = new Image();
        preload.onload = () => {
          img.classList.add('hidden');
          setTimeout(() => {
            img.src = url;
            img.classList.remove('hidden');
          }, 200);
        };
        preload.onerror = () => {
          console.warn('Failed to load image:', url);
        };
        preload.src = url;
      });
    }

    function refreshAll() {
      const imgs = monitorCards.map(card => document.getElementById(`img-${card.id}`)).filter(Boolean);
      refreshImages(imgs);
    }

    function startInterval() {
      clearInterval(timer);
      timer = setInterval(refreshAll, intervalSec * 1000);
    }

    function focusImage(img, cx, cy, baseScale, minWidth = 0) {
      if (!img) return;
      
      const frame = img.parentElement;
      const frameW = frame.clientWidth;
      const frameH = frame.clientHeight;

      // Use fixed dimensions like in ready.html
      const origW = 1000;
      const origH = 1000;

      const scaleX1 = frameW / (2 * cx);
      const scaleX2 = frameW / (2 * (origW - cx));
      const scaleY1 = frameH / (2 * cy);
      const scaleY2 = frameH / (2 * (origH - cy));

      const coverScale = Math.max(scaleX1, scaleX2, scaleY1, scaleY2);
      const baseOrCover = baseScale ?? coverScale;

      let candidateScale = baseOrCover;
      if (minWidth && minWidth > 0) {
        const capByROI = frameW / minWidth;
        candidateScale = Math.min(candidateScale, capByROI);
      }

      const finalScale = candidateScale;
      const scaledW = origW * finalScale;
      const scaledH = origH * finalScale;

      let offsetX = frameW / 2 - cx * finalScale;
      let offsetY = frameH / 2 - cy * finalScale;

      img.style.width = `${scaledW}px`;
      img.style.height = `${scaledH}px`;
      img.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
    }

    function applyFocusAll() {
      monitorCards.forEach(card => {
        const img = document.getElementById(`img-${card.id}`);
        if (img) {
          focusImage(img, card.cx, card.cy, card.baseScale, card.minWidth);
        }
      });
    }

    function createCard(cardData) {
      const maxId = monitorCards.length > 0
      ? Math.max(...monitorCards.map(c => c.id))
      : 0;
    const cardId = (cardData.id !== undefined) ? cardData.id : maxId + 1;
      
      const cardElement = document.createElement('article');
      cardElement.className = 'card';
      cardElement.id = `card-${cardId}`;
      
      const imageUrl = `https://backend.wplace.live/files/s0/tiles/${cardData.tileX}/${cardData.tileY}.png`;
      
      let buttonsHtml = '';
      if (cardData.shareLink) {
        buttonsHtml += `<a href="${cardData.shareLink}" target="_blank" class="goto-btn">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" />
          </svg>
          ë°”ë¡œ ê°€ê¸°
        </a>`;
      }
      
      cardElement.innerHTML = `
        <div class="card-header">
          <button class="download-btn" onclick="confirmDownload(${cardId})">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
          </button>
          <div class="meta">
            <strong>${cardData.name}</strong>
          </div>
          <div class="card-buttons">
            ${buttonsHtml}
            <button class="edit-btn" onclick="editCard(${cardId})">ìˆ˜ì •</button>
            <button class="delete-btn" onclick="confirmDelete(${cardId})">ì‚­ì œ</button>
          </div>
        </div>
        <div class="frame" id="frame-${cardId}">
          <img id="img-${cardId}" data-src="${imageUrl}" alt="${cardData.name}" />
        </div>
      `;
      
      const addCard = document.getElementById('addCard');
      addCard.parentNode.insertBefore(cardElement, addCard);
      
      const cardObj = {
        id: cardId,
        name: cardData.name,
        tileX: cardData.tileX,
        tileY: cardData.tileY,
        cx: cardData.cx,
        cy: cardData.cy,
        baseScale: cardData.baseScale,
        minWidth: cardData.minWidth,
        shareLink: cardData.shareLink || null
      };
      
      monitorCards.push(cardObj);
      
      // ì´ë¯¸ì§€ ë¡œë“œ
      const img = document.getElementById(`img-${cardId}`);
      img.onload = () => {
        focusImage(img, cardObj.cx, cardObj.cy, cardObj.baseScale, cardObj.minWidth);
      };
      refreshImages([img]);
      
      saveToStorage();
      return cardObj;
    }

    function confirmDownload(cardId) {
      const card = monitorCards.find(c => c.id === cardId);
      if (!card) return;

      const confirmDialog = document.createElement('div');
      confirmDialog.className = 'confirm-dialog';
      confirmDialog.innerHTML = `
        <div class="confirm-content">
          <h3>ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</h3>
          <p>í™”ë©´ì— ë³´ì´ëŠ” "${card.name}" ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œ ë©ë‹ˆë‹¤.<br>
CORS ì˜¤ë¥˜ ë°œìƒì‹œ ìƒˆ íƒ­ì—ì„œ ì›ë³¸ ì´ë¯¸ì§€ê°€ ì—´ë¦½ë‹ˆë‹¤.<br> ì´ ê²½ìš° ê°œë°œìì—ê²Œ ë¬¸ì˜ ë°”ëë‹ˆë‹¤.</p>
          <div class="confirm-buttons">
            <button class="btn btn-secondary" onclick="cancelDownload()">ì·¨ì†Œ</button>
            <button class="btn btn-primary" onclick="executeDownload(${cardId})">ë„¤</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(confirmDialog);
      
      // ì• ë‹ˆë©”ì´ì…˜ ì ìš©
      setTimeout(() => {
        confirmDialog.classList.add('show');
      }, 10);
    }

    function cancelDownload() {
      const confirmDialog = document.querySelector('.confirm-dialog');
      if (confirmDialog) {
        confirmDialog.classList.remove('show');
        setTimeout(() => {
          confirmDialog.remove();
        }, 300);
      }
    }

    function executeDownload(cardId) {
      const card = monitorCards.find(c => c.id === cardId);
      const img = document.getElementById(`img-${cardId}`);
      const frame = document.getElementById(`frame-${cardId}`);
      
      if (!card || !img || !frame) return;
      
      // Canvas ìƒì„±í•˜ì—¬ í˜„ì¬ ë³´ì´ëŠ” ì´ë¯¸ì§€ ì˜ì—­ ìº¡ì²˜
      const DPR = 2; // ê³ í•´ìƒë„ ì¶œë ¥ì„ ìœ„í•´ DPR ì„¤ì •
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      const frameRect = frame.getBoundingClientRect();
      canvas.width = frame.clientWidth * DPR;
      canvas.height = frame.clientHeight * DPR;
      
      // ë°°ê²½ìƒ‰ ì„¤ì •
      ctx.fillStyle = 'transparent';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // ì´ë¯¸ì§€ ë¡œë“œ í›„ ê·¸ë¦¬ê¸°
      const tempImg = new Image();
      tempImg.crossOrigin = 'anonymous';
      
      tempImg.onload = () => {
        try {
          // Use fixed dimensions like in the focusImage function
          const origW = 1000;
          const origH = 1000;

          const frameW = frame.clientWidth;
          const frameH = frame.clientHeight;
          const cx = card.cx;
          const cy = card.cy;
          const baseScale = card.baseScale ?? 1;
          const minWidth = card.minWidth || 0;

          const scaleX1 = frameW / (2 * cx);
          const scaleX2 = frameW / (2 * (origW - cx));
          const scaleY1 = frameH / (2 * cy);
          const scaleY2 = frameH / (2 * (origH - cy));

          const coverScale = Math.max(scaleX1, scaleX2, scaleY1, scaleY2);
          const baseOrCover = (baseScale == null) ? coverScale : baseScale;
          let candidateScale = baseOrCover;
          if (minWidth && minWidth > 0) {
            const capByROI = frameW / minWidth;
            candidateScale = Math.min(candidateScale, capByROI);
          }

          const finalScale = candidateScale;
          const scaledW = origW * finalScale;
          const scaledH = origH * finalScale;
          const offsetX = frameW / 2 - cx * finalScale;
          const offsetY = frameH / 2 - cy * finalScale;
         

          // Determine the source rectangle in the original image that maps to the canvas
          const srcX = Math.max(0, (-offsetX) / finalScale);
          const srcY = Math.max(0, (-offsetY) / finalScale);
          const srcW = Math.min(origW - srcX, canvas.width / finalScale);
          const srcH = Math.min(origH - srcY, canvas.height / finalScale);

          // ê³ í•´ìƒë„ ì¶œë ¥ì„ ìœ„í•´ ìŠ¤ì¼€ì¼ ì ìš©
          ctx.scale(DPR, DPR);
          ctx.drawImage(
            tempImg,
            0, 0, origW, origH,  // ì›ë³¸ ì´ë¯¸ì§€ ì „ì²´
            offsetX, offsetY, scaledW, scaledH  // ìº”ë²„ìŠ¤ì— ê·¸ë¦´ ìœ„ì¹˜ì™€ í¬ê¸°
          );
          
          try {
            const link = document.createElement('a');
            link.download = `${card.name}_wplace.png`;
            link.href = canvas.toDataURL();
            link.click();
            cancelDownload();
          } catch (err) {
            console.warn('Canvas toDataURL failed (CORS). Falling back to opening original image.', err);
            const originalUrl = img.dataset.src + '?t=' + Date.now();
            window.open(originalUrl, '_blank');
            cancelDownload();
          }
        } catch (err) {
          console.error('Download error:', err);
          alert('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          cancelDownload();
        }
      };
      
      tempImg.onerror = () => {
        window.open(img.dataset.src + '?t=' + Date.now(), '_blank');
        cancelDownload();
      };
      
      const originalUrl = img.dataset.src + '?t=' + Date.now();
      const proxiedUrl = PROXY_URL_BASE + encodeURIComponent(originalUrl);
      tempImg.src = proxiedUrl;
    }
      
    function confirmDelete(cardId) {
      const card = monitorCards.find(c => c.id === cardId);
      if (!card) return;

      const confirmDialog = document.createElement('div');
      confirmDialog.className = 'confirm-dialog';
      confirmDialog.innerHTML = `
        <div class="confirm-content">
          <h3>ì‚­ì œ í™•ì¸</h3>
          <p>"${card.name}" ì§€ì ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
          <div class="confirm-buttons">
            <button class="btn btn-secondary" onclick="cancelDelete()">ì·¨ì†Œ</button>
            <button class="btn btn-primary" onclick="executeDelete(${cardId})">ë„¤</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(confirmDialog);
      
      setTimeout(() => {
        confirmDialog.classList.add('show');
      }, 10);
    }

    function cancelDelete() {
      const confirmDialog = document.querySelector('.confirm-dialog');
      if (confirmDialog) {
        confirmDialog.classList.remove('show');
        setTimeout(() => {
          confirmDialog.remove();
        }, 300);
      }
    }

    function executeDelete(cardId) {
      deleteCard(cardId);
      cancelDelete();
    }

    function deleteCard(cardId) {
      const cardElement = document.getElementById(`card-${cardId}`);
      if (cardElement) {
        cardElement.remove();
      }
      
      monitorCards = monitorCards.filter(card => card.id !== cardId);
      saveToStorage();
    }

    function editCard(cardId) {
      const card = monitorCards.find(c => c.id === cardId);
      if (!card) return;

      // ëª¨ë‹¬ ì—´ê¸°
      modal.style.display = 'block';
      setTimeout(() => {
        modal.classList.add('show');
      }, 10);
      
      // ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
      document.getElementById('tileX').value = card.tileX;
      document.getElementById('tileY').value = card.tileY;
      document.getElementById('pixelX').value = card.cx;
      document.getElementById('pixelY').value = card.cy;
      document.getElementById('baseScale').value = card.baseScale;
      document.getElementById('minWidth').value = card.minWidth || '';
      document.getElementById('cardName').value = card.name;
      document.getElementById('shareLink').value = card.shareLink || '';
      
      // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ë¡œë“œ
      const imageUrl = `https://backend.wplace.live/files/s0/tiles/${card.tileX}/${card.tileY}.png`;
      const previewImg = document.getElementById('previewImage');
      previewImg.src = imageUrl;
      document.getElementById('previewSection').style.display = 'block';
      
      // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
      document.getElementById('addBtn').textContent = 'ìˆ˜ì •';
      document.getElementById('addBtn').style.display = 'inline-block';
      document.getElementById('addBtn').dataset.editId = cardId;
      
      // ëª¨ë‹¬ ì œëª© ë³€ê²½
      document.querySelector('.modal h3').textContent = 'ê°ì‹œ ì§€ì  ìˆ˜ì •';
      
      clearErrors();
    }

    // ëª¨ë‹¬ ê´€ë ¨
    const modal = document.getElementById('addModal');
    const addCard = document.getElementById('addCard');
    const cancelBtn = document.getElementById('cancelBtn');
    const loadPreviewBtn = document.getElementById('loadPreview');
    const addBtn = document.getElementById('addBtn');

    addCard.addEventListener('click', () => {
  modal.style.display = 'block';
  setTimeout(() => {
    modal.classList.add('show');
  }, 10);
  resetModal();
});

cancelBtn.addEventListener('click', () => {
  modal.classList.remove('show');
  setTimeout(() => {
    modal.style.display = 'none';
  }, 300);
});


        function resetModal() {
      document.getElementById('tileX').value = '';
      document.getElementById('tileY').value = '';
      document.getElementById('pixelX').value = '';
      document.getElementById('pixelY').value = '';
      document.getElementById('baseScale').value = '';
      document.getElementById('minWidth').value = '';
      document.getElementById('cardName').value = '';
      document.getElementById('shareLink').value = '';
      document.getElementById('previewSection').style.display = 'none';
      document.getElementById('addBtn').style.display = 'none';
      document.getElementById('addBtn').textContent = 'ì¶”ê°€';
      document.getElementById('addBtn').removeAttribute('data-edit-id');
      document.querySelector('.modal h3').textContent = 'ê°ì‹œ ì§€ì  ì¶”ê°€';
      clearErrors();
    }

    function clearErrors() {
      document.querySelectorAll('.error').forEach(el => el.textContent = '');
    }

    loadPreviewBtn.addEventListener('click', () => {
      clearErrors();
      
      const tileX = document.getElementById('tileX').value.trim();
      const tileY = document.getElementById('tileY').value.trim();
      
      if (!tileX || !tileY) {
        document.getElementById('tileError').textContent = 'Tl Xì™€ Tl YëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.';
        return;
      }
      
      const imageUrl = `https://backend.wplace.live/files/s0/tiles/${tileX}/${tileY}.png`;
      const previewImg = document.getElementById('previewImage');
      
      previewImg.src = imageUrl;
      previewImg.onload = () => {
        document.getElementById('previewSection').style.display = 'block';
        document.getElementById('addBtn').style.display = 'inline-block';
      };
      
      previewImg.onerror = () => {
        document.getElementById('tileError').textContent = 'ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¢Œí‘œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
      };
    });

    addBtn.addEventListener('click', () => {
      clearErrors();
      
      const tileX = document.getElementById('tileX').value.trim();
      const tileY = document.getElementById('tileY').value.trim();
      const pixelX = document.getElementById('pixelX').value.trim();
      const pixelY = document.getElementById('pixelY').value.trim();
      const baseScale = document.getElementById('baseScale').value.trim();
      const minWidth = document.getElementById('minWidth').value.trim();
      const cardName = document.getElementById('cardName').value.trim();
      const shareLink = document.getElementById('shareLink').value.trim();
      const editId = addBtn.dataset.editId;
      
      let hasError = false;
      
      if (!tileX || !tileY) {
        document.getElementById('tileError').textContent = 'Tl Xì™€ Tl YëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.';
        hasError = true;
      }
      
      if (!pixelX || !pixelY || !baseScale) {
        document.getElementById('pixelError').textContent = 'Px X, Px Y, í™•ëŒ€ ë¹„ìœ¨ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.';
        hasError = true;
      }
      
      if (!cardName) {
        document.getElementById('nameError').textContent = 'ì§€ì  ì´ë¦„ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.';
        hasError = true;
      }
      
      // ë§í¬ ìœ íš¨ì„± ê²€ì¦
      if (shareLink && !shareLink.startsWith('https://wplace.live')) {
        document.getElementById('linkError').textContent = 'ì˜¬ë°”ë¥¸ ë§í¬ê°€ ì•„ë‹™ë‹ˆë‹¤. https://wplace.live ë¡œ ì‹œì‘í•˜ëŠ” ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        hasError = true;
      }
      
      if (hasError) return;
      
      const cardData = {
        name: cardName,
        tileX: parseInt(tileX),
        tileY: parseInt(tileY),
        cx: parseInt(pixelX),
        cy: parseInt(pixelY),
        baseScale: parseFloat(baseScale),
        minWidth: minWidth ? parseInt(minWidth) : 0,
        shareLink: shareLink || null
      };
      
      if (editId) {
        // ìˆ˜ì • ëª¨ë“œ: ê¸°ì¡´ ì¹´ë“œ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  DOMì„ ìˆ˜ì •
        const cardId = parseInt(editId);
        const existingIndex = monitorCards.findIndex(c => c.id === cardId);
        if (existingIndex !== -1) {
          // update data model
          monitorCards[existingIndex] = {
            id: cardId,
            name: cardData.name,
            tileX: cardData.tileX,
            tileY: cardData.tileY,
            cx: cardData.cx,
            cy: cardData.cy,
            baseScale: cardData.baseScale,
            minWidth: cardData.minWidth,
            shareLink: cardData.shareLink || null
          };

          // update DOM elements without changing position
          const img = document.getElementById(`img-${cardId}`);
          const frame = document.getElementById(`frame-${cardId}`);
          const cardEl = document.getElementById(`card-${cardId}`);
          if (img) {
            const imageUrl = `https://backend.wplace.live/files/s0/tiles/${cardData.tileX}/${cardData.tileY}.png`;
            img.dataset.src = imageUrl;
            img.src = imageUrl + '?t=' + Date.now();
            img.onload = () => {
              focusImage(img, cardData.cx, cardData.cy, cardData.baseScale, cardData.minWidth);
            };
          }

          if (cardEl) {
            // update title
            const titleEl = cardEl.querySelector('.meta strong');
            if (titleEl) titleEl.textContent = cardData.name;
            // update goto link if present
            const gotoContainer = cardEl.querySelector('.card-buttons');
            const existingGoto = gotoContainer.querySelector('.goto-btn');
            if (existingGoto) existingGoto.remove();
            
            if (cardData.shareLink) {
              const gotoBtn = document.createElement('a');
              gotoBtn.href = cardData.shareLink;
              gotoBtn.target = '_blank';
              gotoBtn.className = 'goto-btn';
              gotoBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" />
              </svg>ë°”ë¡œ ê°€ê¸°`;
              gotoContainer.insertBefore(gotoBtn, gotoContainer.firstChild);
            }
          }

          saveToStorage();
        }
      } else {
        // ì¶”ê°€ ëª¨ë“œ
        createCard(cardData);
      }
      
      modal.classList.remove('show');
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
      
      // í¬ì»¤ìŠ¤ ì ìš©
      setTimeout(() => {
        applyFocusAll();
      }, 100);
    });

    // ìƒˆë¡œê³ ì¹¨ ê°„ê²© ë³€ê²½
    document.getElementById('interval').addEventListener('change', e => {
      intervalSec = parseInt(e.target.value, 10) || 5;
      startInterval();
      saveToStorage();
    });

    // ì°½ í¬ê¸° ë³€ê²½ ì‹œ í¬ì»¤ìŠ¤ ì¬ì ìš©
    window.addEventListener('resize', applyFocusAll);

    // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ íƒ€ì´ë¨¸ ì •ë¦¬
    window.addEventListener('beforeunload', () => {
      clearInterval(timer);
    });
   
    // ë‹¤í¬ëª¨ë“œ ê´€ë ¨ ì½”ë“œ
    function initDarkMode() {
      const darkModeToggle = document.getElementById('darkModeToggle');
      const sunIcon = document.getElementById('sunIcon');
      const moonIcon = document.getElementById('moonIcon');
  
    // ì €ì¥ëœ í…Œë§ˆ ë¶ˆëŸ¬ì˜¤ê¸°
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    updateIcons(savedTheme);
  
    darkModeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

    // íšŒì „ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
    darkModeToggle.classList.add('rotating');
    setTimeout(() => {
      darkModeToggle.classList.remove('rotating');
    }, 300);
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    updateIcons(newTheme);
  });
  
  function updateIcons(theme) {
    if (theme === 'dark') {
      sunIcon.style.display = 'none';
      moonIcon.style.display = 'block';
    } else {
      sunIcon.style.display = 'block';
      moonIcon.style.display = 'none';
    }
  }
}

// ===== JSON ë‚´ë³´ë‚´ê¸° / ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥ =====

// ë‚´ë³´ë‚´ê¸°
document.getElementById("exportBtn").addEventListener("click", () => {
  const exportData = {
    interval: intervalSec,
    cards: monitorCards.map(c => ({
      id: c.id,
      name: c.name,
      tileX: c.tileX,
      tileY: c.tileY,
      cx: c.cx,
      cy: c.cy,
      baseScale: c.baseScale,
      minWidth: c.minWidth,
      shareLink: c.shareLink
    }))
  };

  const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "wplace-monitor-save.json";
  a.click();
  URL.revokeObjectURL(url);
});

// ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ íŒŒì¼ ì„ íƒì°½ ì—´ê¸°
document.getElementById("importBtn").addEventListener("click", () => {
  document.getElementById("importFile").click();
});

// JSON íŒŒì¼ ì½ê¸° ë° ì ìš©
document.getElementById("importFile").addEventListener("change", (event) => {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const imported = JSON.parse(e.target.result);
      if (!imported.cards) {
        alert("ì˜¬ë°”ë¥´ì§€ ì•Šì€ JSON íŒŒì¼ì…ë‹ˆë‹¤.");
        return;
      }

    // âš ï¸ ê²½ê³  ë¬¸êµ¬ ì¶”ê°€
    const proceed = confirm("ë¶ˆëŸ¬ì˜¤ê¸°ë¥¼ ì§„í–‰í•˜ë©´ ê¸°ì¡´ ë°ì´í„°ê°€ ëª¨ë‘ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
    if (!proceed) return;

      // ê¸°ì¡´ ì¹´ë“œ ì œê±° í›„ ë¡œë“œ
      monitorCards.forEach(c => {
        const el = document.getElementById(`card-${c.id}`);
        if (el) el.remove();
      });
      monitorCards = []; // ë°°ì—´ ì´ˆê¸°í™”
      
      let maxId = 0;
      imported.cards.forEach(card => {
         createCard(card);
         if (card.id > maxId) maxId = card.id;
      });
      cardCounter = maxId;
      intervalSec = imported.interval || 30;
      document.getElementById("interval").value = intervalSec;
      saveToStorage();
      applyFocusAll();

      // ê¸°ì¡´ ìƒˆë¡œê³ ì¹¨ ë£¨í”„ ì´ˆê¸°í™” í›„ ë‹¤ì‹œ ì‹œì‘
      if (refreshTimer) clearInterval(refreshTimer);
      refreshTimer = setInterval(() => {
        refreshAll();
      }, intervalSec * 1000);


      alert("JSON ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.\ní˜ì´ì§€ê°€ ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤.");
      location.reload();
    } catch (err) {
      console.error(err);
      alert("JSON íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  };
  reader.readAsText(file);
});

// ì •ë³´ ëª¨ë‹¬
const infoBtn = document.getElementById("infoBtn");
const infoModal = document.getElementById("infoModal");
const infoClose = document.getElementById("infoClose");

infoBtn.addEventListener("click", () => {
  infoModal.style.display = "block";
  setTimeout(() => {
    infoModal.classList.add("show");
  }, 10);
});

infoClose.addEventListener("click", () => {
  infoModal.classList.remove("show");
  setTimeout(() => {
    infoModal.style.display = "none";
  }, 300);
});

// ê³„ì‚°ê¸° ëª¨ë‹¬ ì—´ê¸°
paintCalcBtn.addEventListener("click", () => {
  calculatorModal.style.display = "block";
  setTimeout(() => {
    calculatorModal.classList.add("show");
  }, 10);
});

// ê³„ì‚°ê¸° ëª¨ë‹¬ ë‹«ê¸°
calcCloseBtn.addEventListener("click", () => {
  calculatorModal.classList.remove("show");
  setTimeout(() => {
    calculatorModal.style.display = "none";
  }, 300);
});

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
calculatorModal.addEventListener("click", (e) => {
  if (e.target === calculatorModal) {
    calculatorModal.classList.remove("show");
    setTimeout(() => {
      calculatorModal.style.display = "none";
    }, 300);
  }
});

// ê³„ì‚° í•¨ìˆ˜
function calculatePaintTime() {
  const pixels = parseInt(remainingPixelsInput.value);
  const hasBadge = hasFlagBadgeCheckbox.checked;
  
  if (!pixels || pixels < 1) {
    resultValue.textContent = "í”½ì…€ ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”";
    return;
  }
  
  // ê¸°ë³¸: 1í”½ì…€ë‹¹ 30ì´ˆ
  let totalSeconds = pixels * 30;
  
  // êµ­ê¸° ë°°ì§€ê°€ ìˆìœ¼ë©´ 10% í™˜ê¸‰
  // 1í˜ì¸íŠ¸ë‹¹ 3ì´ˆ ì°¨ê°, ì¦‰ ì „ì²´ì˜ 10% ì‹œê°„ ê°ì†Œ
  if (hasBadge) {
    totalSeconds = totalSeconds * 0.9;
  }
  
  // ì‹œê°„ í¬ë§·íŒ…
  const days = Math.floor(totalSeconds / 86400);
  const hours = Math.floor((totalSeconds % 86400) / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = Math.floor(totalSeconds % 60);
  
  let timeString = "";
  if (days > 0) timeString += `${days}ì¼ `;
  if (hours > 0) timeString += `${hours}ì‹œê°„ `;
  if (minutes > 0) timeString += `${minutes}ë¶„ `;
  if (seconds > 0 || timeString === "") timeString += `${seconds}ì´ˆ`;
  
  resultValue.textContent = timeString.trim();
}

// ê³„ì‚° ë²„íŠ¼ í´ë¦­
calculateBtn.addEventListener("click", calculatePaintTime);

// ì—”í„°í‚¤ë¡œë„ ê³„ì‚° ê°€ëŠ¥
remainingPixelsInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    calculatePaintTime();
  }
});




    // ì´ˆê¸° ë¡œë“œ
    initDarkMode();
    loadFromStorage();
    startInterval();
  </script>
</body>

</html>
